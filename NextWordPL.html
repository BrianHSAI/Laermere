<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextWordPL</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            /* Definér farver som CSS variabler for nemmere justering */
            --primary-color: #007bff; /* En klar blå */
            --secondary-color: #28a745; /* En grøn */
            --accent-color: #17a2b8; /* En turkis/teal */
            --background-color: #f8f9fa; /* Meget lys grå baggrund */
            --light-grey: #e9ecef; /* Lys grå */
            --medium-grey: #ced4da; /* Medium grå */
            --dark-grey: #343a40; /* Mørk grå tekst */
            --white: #ffffff;
            --box-shadow-light: 0 2px 5px rgba(0, 0, 0, 0.08);
            --box-shadow-medium: 0 4px 8px rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--dark-grey); /* Standard tekstfarve */
        }

        body {
            background-color: var(--background-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1400px; /* Øget maksimal bredde */
            width: 98%; /* Fyld mere af siden på store skærme */
            margin: 0 auto;
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 70px); /* Justeret højde baseret på ny header padding */
        }

        header {
            background-color: #e0f7fa; /* Meget lys turkis baggrund, tæt på billedets header */
            color: var(--dark-grey);
            padding: 25px 0; /* Øget padding i header */
            text-align: center;
            box-shadow: var(--box-shadow-medium);
        }

        h1 {
            font-size: 32px; /* Større overskrift */
            color: #004d40; /* Mørkere grønlig farve til overskrift */
        }

        /* Startskærm */
        #start-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            gap: 25px; /* Større gab */
            background-color: var(--white);
            border-radius: 10px; /* Mere afrundede hjørner */
            box-shadow: var(--box-shadow-medium);
            padding: 50px; /* Mere padding */
        }

        #welcome-message {
            text-align: center;
            max-width: 800px;
        }

        #welcome-message h2 {
            color: var(--dark-grey);
            margin-bottom: 15px;
            font-size: 24px;
        }

        #welcome-message p {
            color: #555;
            line-height: 1.7;
        }

        #text-input-container {
            width: 100%;
            max-width: 900px; /* Større tekstfelt container */
        }

        #initial-text {
            width: 100%;
            height: 350px; /* Større textarea */
            padding: 20px;
            border: 1px solid var(--medium-grey);
            border-radius: 8px;
            resize: vertical;
            font-size: 17px;
            line-height: 1.6;
        }

        #no-text-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            color: var(--dark-grey);
        }

        #start-button {
            margin-top: 40px;
            padding: 14px 30px;
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.3s ease, transform 0.1s ease;
            box-shadow: var(--box-shadow-light);
        }

        #start-button:hover {
            background-color: #0056b3; /* Mørkere blå */
            transform: translateY(-2px); /* Løft mere */
        }

        #start-button:active {
             transform: translateY(0);
        }


        /* Editor skærm */
        #editor-screen {
            display: none; /* Hold denne som none for initial skjulning */
            height: 100%;
            background-color: var(--white);
            border-radius: 10px;
            box-shadow: var(--box-shadow-medium);
            padding: 25px; /* Mere padding */
            flex-direction: column;
            gap: 25px; /* Større gab */
        }

        .editor-container {
            display: flex;
            height: 100%;
            gap: 25px; /* Større gab mellem sidebar og editor */
        }

        /* Sidepanel med importeret tekst */
        .sidebar {
            width: 400px; /* Øget standard bredde */
            flex-shrink: 0;
            transition: width 0.3s ease, flex-shrink 0.3s ease;
            background-color: var(--light-grey); /* Lys grå baggrund */
            border-radius: 10px;
            box-shadow: var(--box-shadow-light);
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Vigtigt: Skjuler indhold der overløber */
            border: 1px solid var(--medium-grey); /* Let kant */
        }

        .sidebar.collapsed {
            width: 70px; /* Lidt bredere kollapset */
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 15px;
            background-color: var(--medium-grey); /* Mørkere grå header baggrund */
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            border-bottom: 1px solid var(--dark-grey); /* Tydeligere kant */
            flex-shrink: 0;
        }

         .sidebar.collapsed .sidebar-header {
            justify-content: center;
         }

        .sidebar-header span {
            font-weight: bold;
            color: var(--dark-grey);
            transition: opacity 0.1s ease;
            display: block;
        }

        .sidebar.collapsed .sidebar-header span {
            opacity: 0;
            pointer-events: none;
            width: 0;
        }

        .toggle-sidebar {
            background: none;
            color: var(--primary-color); /* Blå farve */
            border: none;
            cursor: pointer;
            font-size: 22px; /* Større ikon */
            padding: 0;
            transition: color 0.2s ease, background-color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 35px; /* Større område */
            height: 35px;
            border-radius: 5px;
        }

        .toggle-sidebar:hover {
            color: var(--primary-color);
            background-color: rgba(0, 123, 255, 0.1); /* Let blålig baggrund ved hover */
        }

        .sidebar-content {
            padding: 15px;
            flex-grow: 1;
            overflow-y: auto;
            color: var(--dark-grey);
             opacity: 1;
             transition: opacity 0.2s ease 0.1s;
             pointer-events: auto;
        }

        .sidebar.collapsed .sidebar-content {
             opacity: 0;
             pointer-events: none;
             transition: opacity 0.1s ease;
        }

        .imported-text {
            white-space: pre-wrap;
            user-select: text; /* Tillad markering */
            font-size: 16px;
            line-height: 1.7;
            cursor: pointer; /* Vis at man kan interagerer ved at markere */
        }

        /* Hovedredigeringsfelt */
        .editor-main {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 0;
        }

        .toolbar {
            background-color: var(--light-grey);
            padding: 15px;
            border-radius: 8px;
            box-shadow: var(--box-shadow-light);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            flex-shrink: 0;
            border: 1px solid var(--medium-grey);
        }

        .toolbar button,
        .toolbar select {
             padding: 8px 12px;
             background-color: var(--white);
             color: var(--dark-grey);
             border: 1px solid var(--medium-grey);
             border-radius: 4px;
             cursor: pointer;
             font-size: 15px;
             transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.1s ease;
        }

        .toolbar button:hover,
        .toolbar select:hover {
            background-color: var(--light-grey);
             border-color: var(--medium-grey);
             transform: translateY(-1px);
        }
         .toolbar button:active,
         .toolbar select:active {
             background-color: var(--medium-grey);
             transform: translateY(0);
         }

        .toolbar select {
             min-width: 140px;
        }


        .content-editor {
            flex-grow: 1;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--box-shadow-light);
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--medium-grey);
        }

        #editor {
            flex-grow: 1;
            min-height: 200px;
            border: none;
            padding: 0;
            outline: none;
            line-height: 1.7;
            word-wrap: break-word;
            font-size: 16px;
            cursor: text;
        }

         /* Justering til elementer i editor */
         #editor p, #editor div, #editor h1, #editor h2, #editor h3, #editor h4, #editor h5, #editor h6, #editor ul, #editor ol, #editor blockquote {
             margin-bottom: 1em;
         }
         #editor p:last-child, #editor div:last-child, #editor h1:last-child, #editor h2:last-child, #editor h3:last-child, #editor h4:last-child, #editor h5:last-child, #editor h6:last-child, #editor ul:last-child, #editor ol:last-child, #editor blockquote:last-child {
             margin-bottom: 0;
         }

        /* Container til tællere */
        .count-container {
             display: flex;
             justify-content: flex-end; /* Juster til højre */
             gap: 15px; /* Mellemrum mellem tællere */
             font-size: 14px;
             color: #555;
             margin-top: 10px;
             padding: 0 10px; /* Padding for at matche editor-padding visuelt */
        }

        #word-count,
        #char-count {
            /* Grundstil er i count-container, juster om nødvendigt */
        }


        .actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
            flex-shrink: 0;
        }

        /* Stil til Tilbage-knap */
        .back-button {
             padding: 12px 25px;
             background-color: var(--medium-grey); /* Grålig farve */
             color: var(--dark-grey); /* Mørk tekst */
             border: none;
             border-radius: 5px;
             cursor: pointer;
             font-size: 16px;
             transition: background-color 0.3s ease, transform 0.1s ease;
             box-shadow: var(--box-shadow-light);
        }

         .back-button:hover {
             background-color: #b9c2cb; /* Lidt mørkere grå */
             transform: translateY(-1px);
         }

         .back-button:active {
             transform: translateY(0);
         }


        .action-button { /* Download button */
            padding: 12px 25px;
            background-color: var(--secondary-color);
            color: var(--white);
            border: none;
            border-radius: 5phx;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease, transform 0.1s ease;
            box-shadow: var(--box-shadow-light);
        }

        .action-button:hover {
            background-color: #218838;
            transform: translateY(-1px);
        }

         .action-button:active {
             transform: translateY(0);
         }

    </style>
</head>
<body>
    <header>
        <h1>NextWordPL</h1>
    </header>

    <div class="container">
        <div id="start-screen">
            <div id="welcome-message">
                <h2>Velkommen til NextWordPL</h2>
                <p>Indsæt din tekst nedenfor for at begynde at arbejde med den, eller vælg "Start uden tekst" for at starte fra bunden.</p>
            </div>

            <div id="text-input-container">
                <textarea id="initial-text" placeholder="Indsæt din tekst her..."></textarea>
                <div id="no-text-container">
                    <input type="checkbox" id="no-text-checkbox">
                    <label for="no-text-checkbox">Start uden tekst</label>
                </div>
            </div>

            <button id="start-button">Start NextWordPL</button>
        </div>

        <div id="editor-screen">
            <div class="editor-container">
                <div class="sidebar">
                    <div class="sidebar-header">
                        <span>Importeret tekst</span>
                        <button class="toggle-sidebar" title="Fold sidepanel ind/ud"><i class="fas fa-chevron-left"></i></button>
                    </div>
                    <div class="sidebar-content">
                        <div class="imported-text"></div>
                    </div>
                </div>

                <div class="editor-main">
                    <div class="toolbar">
                        <select id="font-family" title="Skrifttype">
                            <option value="Arial, sans-serif">Arial</option>
                            <option value="'Times New Roman', serif">Times New Roman</option>
                            <option value="Georgia, serif">Georgia</option>
                            <option value="'Courier New', monospace">Courier New</option>
                            <option value="Verdana, sans-serif">Verdana</option>
                            <option value="Tahoma, sans-serif">Tahoma</option>
                             <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif" selected>Segoe UI</option>
                        </select>

                        <select id="font-size" title="Skriftstørrelse">
                            <option value="1">10px</option>
                            <option value="2">12px</option>
                            <option value="3" selected>14px</option>
                            <option value="4">16px</option>
                            <option value="5">18px</option>
                            <option value="6">24px</option>
                            <option value="7">36px</option>
                        </select>

                        <button id="bold-button" title="Fed"><i class="fas fa-bold"></i></button>
                        <button id="italic-button" title="Kursiv"><i class="fas fa-italic"></i></button>
                        <button id="underline-button" title="Understreget"><i class="fas fa-underline"></i></button>

                        <button id="align-left" title="Venstrejusteret"><i class="fas fa-align-left"></i></button>
                        <button id="align-center" title="Centreret"><i class="fas fa-align-center"></i></button>
                        <button id="align-right" title="Højrejusteret"><i class="fas fa-align-right"></i></button>
                    </div>

                    <div class="content-editor">
                        <div id="editor" contenteditable="true"></div>
                    </div>

                     <div class="count-container">
                        <div id="word-count">Ord: 0</div>
                        <div id="char-count">Tegn: 0</div> </div>


                    <div class="actions">
                        <button id="back-button" class="back-button">Tilbage</button>
                        <button id="download-button" class="action-button">Download som PDF</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variabler og DOM-elementer
        const startScreen = document.getElementById('start-screen');
        const editorScreen = document.getElementById('editor-screen');
        const initialTextArea = document.getElementById('initial-text');
        const noTextCheckbox = document.getElementById('no-text-checkbox');
        const startButton = document.getElementById('start-button');
        const importedTextDiv = document.querySelector('.imported-text');
        const editorDiv = document.getElementById('editor');
        const toggleSidebarButton = document.querySelector('.toggle-sidebar');
        const sidebar = document.querySelector('.sidebar');
        const downloadButton = document.getElementById('download-button');
        const backButton = document.getElementById('back-button');
        const toggleSidebarIcon = toggleSidebarButton.querySelector('i');
        const wordCountDiv = document.getElementById('word-count');
        const charCountDiv = document.getElementById('char-count'); // Hent tegn-tæller element

        // Formattering knapper
        const fontFamilySelect = document.getElementById('font-family');
        const fontSizeSelect = document.getElementById('font-size');
        const boldButton = document.getElementById('bold-button');
        const italicButton = document.getElementById('italic-button');
        const underlineButton = document.getElementById('underline-button');
        const alignLeftButton = document.getElementById('align-left');
        const alignCenterButton = document.getElementById('align-center');
        const alignRightButton = document.getElementById('align-right');

        // Funktion til at opdatere ord- og tegntal
        function updateTextStats() {
            const text = editorDiv.textContent; // Hent ren tekst fra editoren

            // Tæl ord
            const words = text.trim().split(/\s+/);
            const wordCount = text.trim() === '' ? 0 : words.length;
            wordCountDiv.textContent = `Ord: ${wordCount}`;

            // Tæl tegn (inklusive mellemrum og linjeskift i textContent)
            const charCount = text.length;
            charCountDiv.textContent = `Tegn: ${charCount}`;

             console.log(`Opdateret: Ord: ${wordCount}, Tegn: ${charCount}`); // Valgfrit: log til konsol
        }


        // Lyt efter ændringer i "Ingen tekst" checkboks
        noTextCheckbox.addEventListener('change', function() {
            initialTextArea.disabled = this.checked;
            if (this.checked) {
                initialTextArea.value = '';
            }
        });

        // Start knap - skift til editor view
        startButton.addEventListener('click', function() {
            let importedText = '';

            if (!noTextCheckbox.checked) {
                importedText = initialTextArea.value;
            }

            // Vis importeret tekst i sidepanelet
            importedTextDiv.textContent = importedText;

            // Skift skærm
            startScreen.style.display = 'none';
            editorScreen.style.display = 'flex';

            // Initialiser tællerne, når editoren vises
            updateTextStats();
        });

        // Fold sidepanel ind/ud
        toggleSidebarButton.addEventListener('click', function() {
            sidebar.classList.toggle('collapsed');

            // Skift ikon baseret på kollapset tilstand
            if (sidebar.classList.contains('collapsed')) {
                toggleSidebarIcon.classList.remove('fa-chevron-left');
                toggleSidebarIcon.classList.add('fa-chevron-right');
            } else {
                toggleSidebarIcon.classList.remove('fa-chevron-right');
                toggleSidebarIcon.classList.add('fa-chevron-left');
            }
        });

        // Forhindre copy-paste i editor
        editorDiv.addEventListener('copy', function(e) {
            e.preventDefault();
             console.log("Copy operation prevented in editor.");
        });

        editorDiv.addEventListener('paste', function(e) {
            e.preventDefault();
             console.log("Paste operation prevented in editor.");
        });

        editorDiv.addEventListener('cut', function(e) {
            e.preventDefault();
             console.log("Cut operation prevented in editor.");
        });

        // Lyt efter input i editoren for at opdatere tællerne
        editorDiv.addEventListener('input', updateTextStats);


        // Overfør markeret tekst fra sidepanel (Indsæt sidst)
        importedTextDiv.addEventListener('mouseup', function() {
            const selection = window.getSelection();
            const selectedText = selection.toString();

            // Tjek om der er markeret tekst, og om markeringen er inde i importedTextDiv
            if (selectedText.length > 0 && (importedTextDiv.contains(selection.anchorNode) || importedTextDiv.contains(selection.focusNode))) {

                // Få fat i den aktuelle markering i vinduet (den i editoren)
                const editorSelection = window.getSelection();

                // Opret en Range, der spænder over hele indholdet af editorDiv
                const rangeAtEnd = document.createRange();
                rangeAtEnd.selectNodeContents(editorDiv);

                // Kollaps Rangen til dens slutpunkt - dette placerer markøren ved slutningen
                rangeAtEnd.collapse(false);

                // Fjern alle eksisterende Ranges fra den globale markering
                editorSelection.removeAllRanges();

                // Tilføj den nye Range (markøren ved slutningen) til markeringen
                editorSelection.addRange(rangeAtEnd);

                // Sæt fokus tilbage på editoren (sikrer at markøren er aktiv)
                editorDiv.focus();

                // Indsæt den markerede tekst fra sidepanelet ved den aktuelle markørposition (som nu er slutningen)
                document.execCommand('insertText', false, selectedText);

                // Opdater tællerne efter indsættelse
                updateTextStats();

                console.log("Tekst overført fra sidepanel og indsat sidst:", selectedText);
            }
        });


        // Tilbage knap
        backButton.addEventListener('click', function() {
            // Naviger tilbage til index.html
            window.location.href = 'index.html';
        });


        // Formattering funktioner (document.execCommand)
        boldButton.addEventListener('click', function() {
            document.execCommand('bold', false, null);
            editorDiv.focus();
        });

        italicButton.addEventListener('click', function() {
            document.execCommand('italic', false, null);
             editorDiv.focus();
        });

        underlineButton.addEventListener('click', function() {
            document.execCommand('underline', false, null);
             editorDiv.focus();
        });

        fontFamilySelect.addEventListener('change', function() {
            document.execCommand('fontName', false, this.value);
             editorDiv.focus();
        });

        fontSizeSelect.addEventListener('change', function() {
             document.execCommand('fontSize', false, this.value);
             editorDiv.focus();
        });

        alignLeftButton.addEventListener('click', function() {
            document.execCommand('justifyLeft', false, null);
             editorDiv.focus();
        });

        alignCenterButton.addEventListener('click', function() {
            document.execCommand('justifyCenter', false, null);
             editorDiv.focus();
        });

        alignRightButton.addEventListener('click', function() {
            document.execCommand('justifyRight', false, null);
             editorDiv.focus();
        });


        // Download som PDF
        downloadButton.addEventListener('click', function() {
            const { jsPDF } = window.jspdf;

            const pdf = new jsPDF('p', 'mm', 'a4');

            html2canvas(editorDiv, {
                scale: 2,
                logging: false,
                useCORS: true
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');

                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                const margin = 15;

                let imgWidth = pdfWidth - (2 * margin);
                let imgHeight = (canvas.height * imgWidth) / canvas.width;
                let imgX = margin;
                let imgY = margin;

                const availableHeight = pdfHeight - (2 * margin) - 10;

                if (imgHeight > availableHeight) {
                     const aspectRatio = canvas.width / canvas.height;
                     imgHeight = availableHeight;
                     imgWidth = imgHeight * aspectRatio;
                     imgX = (pdfWidth - imgWidth) / 2;
                }

                pdf.addImage(imgData, 'PNG', imgX, imgY, imgWidth, imgHeight);

                const now = new Date();
                const timestamp = `Genereret: ${now.toLocaleDateString('da-DK')} ${now.toLocaleTimeString('da-DK')}`;

                pdf.setFontSize(10);
                const timestampX = margin;
                const timestampY = pdfHeight - margin + 5;

                 pdf.text(timestamp, timestampX, timestampY);

                pdf.save('NextWordPL-dokument.pdf');
            }).catch(error => {
                console.error("Fejl ved generering af PDF:", error);
                alert("Der opstod en fejl under generering af PDF'en.");
            });
        });
    </script>
</body>
</html>